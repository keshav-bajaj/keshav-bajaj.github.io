/**
 * Javascript Fluid Meter
 * by Angel Arcoraci
 * https://github.com/aarcoraci
 * 
 * MIT License
 */
function FluidMeter(){function r(){var a=(new Date).getTime();t=(a-(u||a))/1E3;u=a;requestAnimationFrame(r);c.clearRect(0,0,b.width,b.height);c.save();c.fillStyle=b.backgroundColor;c.beginPath();c.arc(b.size/2,b.size/2,f()/2-b.borderWidth,0,2*Math.PI);c.closePath();c.fill();c.restore();a=t;c.save();c.arc(b.size/2,b.size/2,f()/2-b.borderWidth,0,2*Math.PI);c.clip();v(h,a);v(g,a);if(b.drawBubbles){var e=g,d=0,p=e.maxAmplitude*Math.sin(e.angle*Math.PI/180);c.beginPath();for(c.lineTo(0,e.initialHeight);d<
b.size;){var m=e.initialHeight+p*Math.sin((d+e.horizontalPosition)/e.frequency);c.lineTo(d,m);d++}c.lineTo(d,b.size);c.lineTo(0,b.size);c.closePath();c.clip();c.save();for(e=0;e<k.bubbles.length;e++)d=k.bubbles[e],c.beginPath(),c.strokeStyle="white",c.arc(d.x,d.y,d.r,2*Math.PI,!1),c.stroke(),c.closePath(),m=k.current*a,d.velX=Math.abs(d.velX)<Math.abs(k.current)?d.velX+m:k.current,d.y-=d.velY*a,d.x=d.x+(k.swing?.4*Math.cos(k.swing+=.03)*k.swing:0)+.5*d.velX,m=b.size-(b.size-f())/2-b.borderWidth,p=
l*(f()-2*b.borderWidth)/100,d.y<=m-p&&k.reset(d);c.restore()}c.restore();b.drawText&&(a=b.drawPercentageSign?l.toFixed(0)+"%":l.toFixed(0),c.save(),c.font=b.fontSize+" "+b.fontFamily,c.fillStyle=b.fontFillStyle,c.textAlign="center",c.textBaseline="middle",c.filter="drop-shadow(0px 0px 5px rgba(0,0,0,0.4))",c.fillText(a,b.size/2,b.size/2),c.restore());c.save();c.lineWidth=b.borderWidth;c.strokeStyle=b.foregroundColor;c.beginPath();c.arc(b.size/2,b.size/2,f()/2-b.borderWidth/2,0,2*Math.PI);c.closePath();
c.stroke();c.restore()}function v(a,e){0<a.angularSpeed&&(a.angle+=a.angularSpeed*e,a.angle=0>a.angle?a.angle+360:a.angle);a.horizontalPosition+=a.horizontalSpeed*e;0<a.horizontalSpeed?a.horizontalPosition>Math.pow(2,53)?0:a.horizontalPosition:0>a.horizontalPosition&&(a.horizontalPosition<-1*Math.pow(2,53)?0:a.horizontalPosition);var d=0,p=a.maxAmplitude*Math.sin(a.angle*Math.PI/180);var m=b.size-(b.size-f())/2-b.borderWidth;var x=l*(f()-2*b.borderWidth)/100;l<q?l+=15*e:l>q&&(l-=15*e);a.initialHeight=
m-x;c.save();c.beginPath();for(c.lineTo(0,a.initialHeight);d<b.size;)m=a.initialHeight+p*Math.sin((d+a.horizontalPosition)/a.frequency),c.lineTo(d,m),d++;c.lineTo(d,b.size);c.lineTo(0,b.size);c.closePath();c.fillStyle=a.fillStyle;c.fill();c.restore()}function f(){return.9*b.size}function n(a,e){return e===a?a:Math.random()*(e-a)+a}var c,w,u=null,t=null,b={drawShadow:!0,drawText:!0,drawPercentageSign:!0,drawBubbles:!0,fontSize:"70px",fontFamily:"Arial",fontFillStyle:"white",size:300,borderWidth:25,
backgroundColor:"#e2e2e2",foregroundColor:"#fafafa"},l=0,q=0,g={fillStyle:"purple",angle:0,horizontalPosition:0,angularSpeed:0,maxAmplitude:9,frequency:30,horizontalSpeed:-150,initialHeight:0},h={fillStyle:"pink",angle:0,horizontalPosition:0,angularSpeed:140,maxAmplitude:12,frequency:40,horizontalSpeed:150,initialHeight:0},k={bubbles:[],amount:12,speed:20,current:0,swing:0,size:2,reset:function(a){var e=b.size-(b.size-f())/2-b.borderWidth,d=l*(f()-2*b.borderWidth)/100;a.r=n(this.size,2*this.size)/
2;a.x=n(0,b.size);a.y=n(e,e-d);a.velX=0;a.velY=n(this.speed,2*this.speed);a.swing=n(0,2*Math.PI)},init:function(){for(var a=0;a<this.amount;a++){var e=b.size-(b.size-f())/2-b.borderWidth,d=l*(f()-2*b.borderWidth)/100;this.bubbles.push({x:n(0,b.size),y:n(e,e-d),r:n(this.size,2*this.size)/2,velX:0,velY:n(this.speed,2*this.speed)})}}};return{init:function(a){if(!a.targetContainer)throw"empty or invalid container";w=a.targetContainer;q=Math.min(Math.max(a.fillPercentage,0),100);a.options&&(b.drawShadow=
!1===a.options.drawShadow?!1:!0,b.size=a.options.size,b.drawBubbles=!1===a.options.drawBubbles?!1:!0,b.borderWidth=a.options.borderWidth||b.borderWidth,b.foregroundFluidColor=a.options.foregroundFluidColor||b.foregroundFluidColor,b.backgroundFluidColor=a.options.backgroundFluidColor||b.backgroundFluidColor,b.backgroundColor=a.options.backgroundColor||b.backgroundColor,b.foregroundColor=a.options.foregroundColor||b.foregroundColor,b.drawText=!1===a.options.drawText?!1:!0,b.drawPercentageSign=!1===
a.options.drawPercentageSign?!1:!0,b.fontSize=a.options.fontSize||b.fontSize,b.fontFamily=a.options.fontFamily||b.fontFamily,b.fontFillStyle=a.options.fontFillStyle||b.fontFillStyle,a.options.foregroundFluidLayer&&(g.fillStyle=a.options.foregroundFluidLayer.fillStyle||g.fillStyle,g.angularSpeed=a.options.foregroundFluidLayer.angularSpeed||g.angularSpeed,g.maxAmplitude=a.options.foregroundFluidLayer.maxAmplitude||g.maxAmplitude,g.frequency=a.options.foregroundFluidLayer.frequency||g.frequency,g.horizontalSpeed=
a.options.foregroundFluidLayer.horizontalSpeed||g.horizontalSpeed),a.options.backgroundFluidLayer&&(h.fillStyle=a.options.backgroundFluidLayer.fillStyle||h.fillStyle,h.angularSpeed=a.options.backgroundFluidLayer.angularSpeed||h.angularSpeed,h.maxAmplitude=a.options.backgroundFluidLayer.maxAmplitude||h.maxAmplitude,h.frequency=a.options.backgroundFluidLayer.frequency||h.frequency,h.horizontalSpeed=a.options.backgroundFluidLayer.horizontalSpeed||h.horizontalSpeed));k.init();a=document.createElement("canvas");
a.width=b.size;a.height=b.size;a.imageSmoothingEnabled=!0;c=a.getContext("2d");w.appendChild(a);b.drawShadow&&(c.save(),c.beginPath(),c.filter="drop-shadow(0px 4px 6px rgba(0,0,0,0.1))",c.arc(b.size/2,b.size/2,f()/2,0,2*Math.PI),c.closePath(),c.fill(),c.restore());r()},setPercentage:function(a){q=Math.min(Math.max(a,0),100)}}};